#!/bin/csh
#
# $Id: mkshobjlib,v 1.9 2004-11-11 15:39:19 dgb Exp $
# This script creates a shared object lib from a number of input libraries
#_______________________________________________________________________________


if ( $#argv < 3 ) then
	echo "Usage: $0 Input_lib Output_sharedlib [win: deffile] Linker_and_flags"
	exit 1
endif

set inplibs=""
foreach lib ( $* )

    if ( "$lib" == "--output" ) goto inplibs_done

    if ( ! -r "$lib" ) then
	    echo "$0 : Input lib $lib cannot be accessed"
	    exit 1
    endif

    set inplibs="$inplibs $lib"
    shift

end
inplibs_done:
shift

set outlib=$1
shift

if ( $HDIR == "win") then

    $* -o $outlib
    set exitstat=$status

else

    set tmpdir=`$PMAKE/bin/get_temp_file_name`

    if ( ! -d $tmpdir ) mkdir $tmpdir
    if ( ! -d $tmpdir ) then
	    echo "$0 : Cannot create $tmpdir"
	    exit 1
    endif

    cd $tmpdir

    foreach lib ( $inplibs )
	if ( $HDIR == "mac") then
		ar x $lib `ar t $lib | grep -v __.SYMDEF `
	else
		ar x $lib `ar t $lib `
	endif
    end

#    echo $* *.o -o $outlib
    $* *.o -o $outlib
    set exitstat=$status
    cd /tmp

    rm -rf $tmpdir

endif



exit $exitstat
