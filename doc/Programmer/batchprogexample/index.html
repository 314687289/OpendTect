<html>
<!--
  - CopyRight:	(C) dGB Earth Sciences
  - Author:	Bert
  - Date:	Aug 2012
  - Contents:	Some things on making batch programs
  - RCS:	$Id: index.html,v 1.1 2012/08/30 07:50:55 cvsbert Exp $
 -->

<body background="../backg.png"><title>Batch Programs in OpendTect</title>

<table width="100%" border="0">
<tr>
        <td width="70%"align=left><h1>Batch Programs in OpendTect</h1></td>
        <td width="10%"align=left><small>Bert Bril</small></td>
        <td width="20%" align=right><a href="http://www.opendtect.org" target="popup"><img border=0 src="../od.png" height=150 width=150></a></td>
</tr>
</table>
<center><small>Before reading this page, you may consider reading <a href="../overview.html">the overview doc</a> first.</small></center>

<br><br>
<img src="../hr.png" border=0>
<br><br>

<p>
What we call a 'batch program' is usually called 'console program' on Windows. All our batch programs accept a single parameter file as argument, and optionally '-bg' if it has to run in the background (it will be ignored on Windows though).
</p>
<p>
Rather than specifying a 'main', you have to specify:
<pre>
bool BatchProgram::go(std::ostream&);
</pre>

The <code>std::ostream&</code> parameter is the log file you can write to. It can be specified in the par file:

<pre>
Log file: window
</pre>

other possibilities are 'stdout' or a file name.
</p>
<p>

That reveals what the par file is: a standard OpendTect Ascii data file with an asistream/ascostream header (see Basic/ascstream.h) and as contents a single IOPar written with <code>IOPar::putTo(ascostream&)</code> (see Basic/iopar.h). This file is read by the BatchProgram constructor into an IOPar instance which is available as 'pars()', like in:

<pre>
const bool usewavelet = pars().isTrue( "Use Wavelet" );
</pre>

That would become false if the par file contains a line like:

<pre>
Use Wavelet: No
</pre>
</p>
<p>
Rather than returning an <code>int</code>, like <code>main()</code>, you return a <code>bool</code>. You can of course always use <code>ExitProgram(int)</code> from genc.h to return another value than 0 or 1 from <code>main()</code>.
</p>
<p>

Example code is in <a href="od_example_batchprog.cc">od_example_batchprog.cc</a>, the program's example par file is <a href="od_example_batchprog.par">od_example_batchprog.par</a>. In CMakeLists.txt you need to add a line like:
<pre>
SET(OD_MODULE_BATCHPROGS your_program_file_name_without_cc_extension  )
</pre>
Output from the example program:<br><img src="snapshot_output.png">.
</p>

<br><br>
<img src="../hr.png" border=0>

</body>
</html>
