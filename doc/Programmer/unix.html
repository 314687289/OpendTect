<html>
<!--
  - CopyRight:  (C) dGB Earth Sciences
  - Author:     Bert
  - Date:       Jan 2004
  - Contents:   Getting started developping your own plugins.
  - RCS:        $Id: unix.html,v 1.18 2012-04-17 14:00:02 cvsbert Exp $
 -->

<body background="backg.png"><title>Getting started with OpendTect development [OpendTect Programmer's manual V4.1]</title>
<center>
<h1>Getting started with OpendTect development</h1>
  <a href=#intro>Intro</a>
| <a href=#prereq>Prerequisites</a>
| <a href=#setup>Setup</a>
| <a href=#buildod>Building OpendTect</a>
</center>
<br>
<img src="hr.png" border=0>

<a name=intro><h2>Intro</h2></a>
<p>
In principle, anyone can build the full OpendTect system from source. Fortunately, OpendTect has a <a href="plugins.html">plugin</a> architecture which makes it much easier to start developing. Therefore, this manual will focus on plugin development rather than building the entire OpendTect from scratch. If for some reason you are interested in building the entire OpendTect, follow the instructions for plugin development before going <a href=#buildod">here</a>). Even if you want to build for a completely new platform, the first step would still be to get your environment ready for plugin development.
</p><p>
For both types of development you should have installed a fully functional OpendTect system before you start. Even when you build the entire OpendTect, you'll want to be able to use some of the libraries from the distribution.
</p><p>
MS Windows-based developers should not be here: instead, go to the <a href="windows.html">windows development section</a>.
</p>

<a name=prereq><h2>Prerequisites</h2></a>
<p>
Before you can start developing, there are a few external programs that need
to be installed.
</p><p>
The following programs should be available:
</p>
<ul>
<li><a href="http://cmake.org">CMake</a>
<li><a href="http://gcc.gnu.org">GNU gcc/g++ >= 3.4.x</a>
<li>csh (any, as long as you have one installed)
</ul>

<a name=setup><h2>Setting up the environment</h2></a>

<p>
<a href="http://cmake.org">CMake</a> is used to build both the entire system aswell as plugins.
</p>


<h3>Setup ODWork dir</h3>

<p>
It is strongly recommended to make sure that there are no spaces in the path
to your ODWork directory. A good place for your ODWork directory may be a subdirectory of your home directory. 
</p>

<p>
The only environment variable besides the one you may want to use for your own CMake settings is $WORK. Set it to the root of your development tree (which itself contains the plugin subdirectories).
</p><p>
For CMake to work easily, try linking the Qt, COIN and OSG installations immediately in $WORK. CMake will automatically configure from this. Example:
<pre><code>ln -s /apps/qt/inst_453 $WORK/qt
ln -s /apps/coin/inst_rel $WORK/coin
ln -s /apps/osg/inst_rel $WORK/osg
</code></pre>
</p>

<h3>Building your own plugins</h3>
<h4>Testing the installation</h4>

<p>
After 'cmake .' (ceemake dot) in the root of your development environment you can simply use make in each plugin directory. Then, as a test, try to make some changes in plugins/Hello and run make.
</p>

<h3>Building the Tutorial plugins : Tut, uiTut</h3>

<p>
You can test your newly compiled plugins by loading them using the Utilities-plugins menu in OpendTect. For example, if you load the "libHello.so" plugin, you should see "Hello World" on the OpendTect console window. Note that when plugins depend on other plugins, the order of loading matters.
</p>
<p>After you setup your environment, open a new shell and go to your ODWork directory. Run<br>
<code>cmake .</code><br>
This should configure cmake and generate Makefiles needed to compile the example plugins. Please note that normally you will need to run cmake explicitly only once. After that, make takes care of it. Then simply use<br>
<code>make</code><br>
to build the plugins. The libraries will be stored in ODWORK/bin/<plfdir> where <plfdir> is lux32, lux64 or mac depending on your platform. Now you can load these plugins (.so file) into OpendTect using Utilities->Plugins.<p>

<h3>Building your own plugins</h3>
<p>As a first step towards OpendTect plugin development you can actually replace the name 'My_Plugin_Name' with a name of your choice and start playing with the plugin by adding your own code to it. Make sure the plugin name contains NO SPACES. For example, Here is how to rename My_Plugin_Name to NewGeoPhyTool:<br>

<ul>
<li>Replace all occurrences of My_Plugin_Name in the file my_plugin_name_pi.cc<br>
<li>Rename the folder My_Plugin_Name to NewGeoPhyTool<br>
<li>Replace all occurrences of My_Plugin_Name with NewGeoPhyTool in the file ODWORK/CMakeLists.txt<br>
<li>Add your own code to the existing sorce files in ODWORK/plugins/NewGeoPhyTool and optionally add your own sorce files in which case you need to add them to ODWORK/NewGeoPhyTool/CMakeLists.txt as well<br>
<li>Run make in ODWORK
<li>If all goes well, you will have your plugin library NewGeoPhyTool.so in ODWORK/bin/<plfdir><br>
<li>Now load the new plugin library into OpendTect and enjoy the results of your work!<br>
</ul>
<p>

There is no way to un-load a plugin. That means you have to exit OpendTect to test a new version (e.g. after recompile).
</p>

<a name=installplugins><h4>Installing your plugins</h4>

<p> Installing a plugin means: making it auto-loaded. This removes the nuisance of having to load the plugin each time you start OpendTect. On the other hand, when you're still developing you may not want the plugin to be loaded all the time. Anyway, the plugins are installed by linking or copying them to the correct plugin subdirectory in either your personal '.od' settings directory, or in the program installation directory and making a configuration ".alo" file. 
This is the same on Unix and Windows, so please consult the plugins <a href="plugins.html#autoload">auto-load and installation</a> documentation for more details.

<a name=dist><h2>Distributing your plugins</h2>

<p>
The distribution of plugins is basically the same for Unix and windows. 
Just copy the .alo files into the plugins/platform directory (<code>$DTECT_APPL/plugins/$HDIR</code>) and copy the actual plugins into the <code>bin/$DIR</code> subdirectory, where all shared libs reside.
</p>
<p>
For distribution to the outside world, you'll need to package your plugins, documentation, etc. into .tar.gz files on Unix. For all details on what exactly should be packaged and how, we'd recommend contacting support at opendtect.org.
</p>


<a name=buildod><h2>Building from source</h2>
<p>
If you're really into it, you can build the entire OpendTect from source after you've installed OpendTect and built a plugin. For that, you will have to get hold of a Qt and a COIN source distribution. This is because you'll need the correct header files to go with the libraries.

<h4>Qt = http://www.trolltech.no</h4>
<a href="http://www.trolltech.no">Qt from TrollTech</a> (now Nokia) is used for the GUI. Use Qt 4.5 or lower. We configured with:<br>
<code>
./configure -shared -release -no-gif -enable-opengl -thread -no-g++-exceptions -disable-xml -disable-sql -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -qt-libpng -qt-libjpeg -qt-libmng -qt-imgfmt-jpeg -qt-imgfmt-mng -qt-imgfmt-png
</code>

<h4>COIN</h4>
You need the main <a href="http://www.sim.no">COIN</a> library ('Coin-2') and SoQt. For the volume rendering plugin, find the SIMVoleon download too. In rare cases you also want simage. Our configuration:<br>
<code>
./configure --disable-debug --disable-symbols --enable-shared --disable-static --enable-vrml97 --enable-threadsafe --enable-rtti --disable-warnings --disable-dependency-tracking --enable-html CFLAGS="-O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64" CPPFLAGS="-O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64" LDFLAGS="-s -O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -lstdc++"
</code>
</p><p>
Once this is done, link your Qt and Coin installation directories to $WORK, as in:
<code>
cd $WORK
ln -s /apps/qt/inst_dir ./qt
ln -s /apps/coin/inst_dir ./coin
</code>
Now, you can configure cmake. As always, do a 'cmake .', this time in $WORK itself. If configuring succeeds, 'make' should do the trick.
<p>

<br>
<img src="hr.png" border=0>

<p>
<center>
  <a href="index.html">Index</a>
| <a href="overview.html">Overview</a>
| <a href="plugins.html">Plugins</a>
| <a href="http://www.opendtect.org">opendtect.org</a>
</center>
</p>

</body>
</html>
