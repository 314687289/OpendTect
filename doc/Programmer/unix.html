<html>
<!--
  - CopyRight:  (C) dGB Earth Sciences
  - Author:     A.H. Lammertink / A.H. Bril
  - Date:       Jan 2004
  - Contents:   Getting started developping your own plugins.
  - RCS:        $Id: unix.html,v 1.11 2006-08-07 11:40:37 bert Exp $
 -->

<body background="../backg.png"><title>Getting started with OpendTect development [OpendTect Programmer's manual V2.4]</title>
<center>
<h1>Getting started with OpendTect development</h1>
  <a href=#intro>Intro</a>
| <a href=#prereq>Prerequisites</a>
| <a href=#setup>Setup</a>
| <a href=#buildod>Building OpendTect</a>
</center>
<br>
<img src="../hr.png" border=0>

<a name=intro><h2>Intro</h2></a>
<p>
In principle, anyone can build the full OpendTect system from source. Fortunately, OpendTect has a <a href="plugins.html">plugin</a> architecture which makes it much easier to start developing. Therefore, this manual will focus on plugin development rather than building the entire OpendTect from scratch. If for some reason you are interested in building the entire OpendTect, follow the instructions for plugin development before going <a href=#buildod">here</a>). Even if you want to build for a completely new platform, the first step would still be to get your environment ready for plugin development because the same environment is used for making the entire Opendtect.
</p><p>
For both types of development you should have installed a fully functional OpendTect system before you start. Even when you build the entire OpendTect, you'll want to be able to use some of the libraries from the distribution.
</p><p>
MS Windows-based developers should not be here: instead, go to the <a href="windows.html">windows development section</a>.
</p>

<a name=prereq><h2>Prerequisites</h2></a>
<p>
Before you can start developing, there are a few external programs that need
to be installed.
</p><p>
The following programs should be available:
</p>
<ul>
<li>GNU make
<li>GNU gcc 3.4.x, including g++
<li>perl (for header file dependencies)
</ul>
<p>Recommended but fully optional are:</p>
<ul>
<li>CVS
<li>tcsh
<li>GNU Binutils
<li>GNU Bison(*)
<li>GNU Flex (*)
<li>Doxygen
<li>GNU awk (gawk)
</ul>
(*) Bison and Flex may be required to build the entire OpendTect itself.</p>


<a name=setup><h2>Setting up the environment</h2></a>

<p>
<a href="pmake.html">Pmake</a> is used to build both the entire system aswell as plugins. It requires a few environment variables to be setup and it expects a
certain directory structure in your OpendTect Work directory.
</p>


<h3>Setup ODWork dir</h3>

<p>
Before you can build anything, you should let OpendTect setup a new ODWork directory. The easiest way to do this is from within OpendTect, menu 'Utilities-Create Devel. Env.'. This function will make sure you get a full environment that is 'ready to go'. Note that the OpendTect application window will freeze while the development environment is created.
</p><p>
When OpendTect is finished, you will find a fresh ODWork directory with all sources, libs, Makefile and so forth, aswell as init scripts 'init.bash' and 'init.csh'. One of these must be sourced in order to setup the environment in such a way that Pmake and other tools should work immediately.
</p>
<p>
It is strongly recommended to make sure that there are no spaces in the path
to your ODWork directory. A good place for your ODWork directory is your
home directory. 
</p>


<h3>Setup environment variables</h3>

<p>
The init.csh/init.bash scripts (created by the 'Create Devel. Env.' utility) are making guesses about a few pieces of information that are essential to the work of Pmake:
<ul>
<li>HDIR defines the platform you're working on, which is eigther lux, sun5, mac, sgi or win.
<li>GNUMAKE is the gnu make executable, usually just make or gmake.
<li>WORK defines where your ODWork directory is.
<li>DEBUG defines whether optimisation is switched on and symbols are added to the libraries and executables. Default is 'yes'.
</ul>
</p><p>
If the guessed values are not correct, you can overrule them by setting the variables before your init script is sourced. Of course you can source the init script from your login script, e.g. in your ~/.bashrc:
<pre>
    source ~/ODWork/init.bash
</pre>
</p>

<h3>Building your own plugins</h3>
<h4>Testing the installation</h4>

<p>
After you setup your environment, open a new shell and go to your ODWork directory. If you have sourced your init script from .bashrc or .login, the alias 'cdw' should bring you directly to your ODWork directory. Then go to the plugins directory, subdirectory Hello and type 'make'. You should see something like this:
</p>
<pre>
% cd plugins/Hello
% make
Making Hello / Linux (Jan 16 09:37:18) DEBUG=yes.
Compiling hellopi.cc ...
Ranlib on libHello.a ...
Creating /users/bert/ODWork/lib/lux/G/libHello.so ...
  Done !
%</pre>
If this doesn't give similar output but errors, try the command 'make -n', which shows what make will do without actually doing it:
<pre>
% make -n
rm -f lslux
echo "  Making Hello / Linux (Jan 16 09:41:52) DEBUG=yes." | tee -a lslux
echo "Compiling hellopi.cc ... " | tee -a lslux
g++ -c -ggdb3  -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -DSYSV -D__debug__ -Dlux -D__shared__ -fsigned-char -Wconversion -Wimplicit -Wmissing-prototypes -Wparentheses -Wreturn-type -Werror -Wno-non-template-friend  -I/users/bert/ODWork/include   -I. hellopi.cc -o /tmp/hellopi.o 1&gt;&gt;lslux 2&gt;&amp;1
ar rv /users/bert/ODWork/lib/lux/G/libHello.a /tmp/hellopi.o 1&gt;&gt;lslux 2&gt;&amp;1
rm -f /tmp/hellopi.o
echo "Ranlib on libHello.a ... " | tee -a lslux
ranlib /users/bert/ODWork/lib/lux/G/libHello.a
echo "Creating /users/bert/ODWork/lib/lux/G/libHello.so ..." | tee -a lslux
/users/bert/ODWork/Pmake/base/bin/mkshobjlib /users/bert/ODWork/lib/lux/G/libHello.a --output /users/bert/ODWork/lib/lux/G/libHello.so \
g++ -L/users/bert/ODWork/lib/lux/G  -shared -ggdb3  -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -DSYSV -D__debug__ -Dlux -D__shared__ -fsigned-char -Wconversion -Wimplicit -Wmissing-prototypes -Wparentheses -Wreturn-type -Werror -Wno-non-template-friend  -I/users/bert/ODWork/include   -I. 1&gt;&gt;lslux 2&gt;&amp;1
echo "  Done !" | tee -a lslux
%
</pre>
Anyway, when you have the 'Hello world' thing going, try a more 'demanding' plugin. For example the simple file seismic import:
<pre>
% cd ../uiSeisIOSimple
% make
  Making uiSeisIOSimple / Linux (Jan 16 09:38:13) DEBUG=yes.
Compiling seisiosimple.cc ...
Compiling uiseisiosimple.cc ...
Compiling uiseisiosimplepi.cc ...
Ranlib on libuiSeisIOSimple.a ...
Creating /users/bert/ODWork/lib/lux/G/libuiSeisIOSimple.so ...
  Done !
%</pre>
<p>
The libraries should now be created in $WORK/lib/$HDIR (in the example case /users/bert/ODWork/lib/lux/G). If anything goes wrong during compile and/or link, the error messages are sent to a file lslux (or lssun5 or lssgi depending on your OS) in the source directory. If you want to see these immediately, set the environment variable OUTSTDOUT to yes. You can also add this for each make run, then type:
<pre>make OUTSTDOUT=yes</pre>
</p>

<h4>Testing the newly compiled plugins</h4>

<p>
You can test your newly compiled plugins by loading them using the Utilities-plugins menu in OpendTect. For example, if you load the "libHello.so" plugin, you should see "Hello World" on the OpendTect console window. Note that when plugins depend on other plugins, the order of loading matters.
</p><p>
There is no way to un-load a plugin. That means you have to exit OpendTect to test a new version (e.g. after recompile).
</p>

<a name=installplugins><h4>Installing your plugins</h4>

<p> Installing a plugin means: making it auto-loaded. This removes the nuisance of having to load the plugin each time you start OpendTect. On the other hand, when you're still developing you may not want the plugin to be loaded all the time. Anyway, the plugins are installed by linking or copying them to the correct plugin subdirectory in either your personal '.od' settings directory, or in the program installation directory and making a configuration ".alo" file. 
This is the same on Unix and Windows, so please consult the plugins <a href="plugins.html#autoload">auto-load and installation</a> documentation for more details.

<a name=dist><h2>Distributing your plugins</h2>

<p>
The distribution of plugins is basically the same for Unix and windows. 
Just copy the .alo files into the plugins/platform directory (<code>$DTECT_APPL/plugins/$HDIR</code>) and copy the actual plugins into the libs subdirectory.
</p>
<p>
For distribution to the outside world, you'll need to package your plugins, documentation, etc. into .tar.gz files on Unix. For all details on what exactly should be packaged and how, we'd recommend contacting support at opendtect.org.
</p>


<a name=buildod><h2>Building from source</h2>
<p>
If you're really into it, you can build the entire OpendTect from source after you've installed OpendTect and built a plugin. For that, you will have to get hold of a Qt and a COIN source distribution. This is because you'll need the correct header files to go with the libraries.

<h4>Qt = http://www.trolltech.no</h4>
Any recent Qt distribution will do. We configure with:
<code>
./configure -shared -release -no-gif -enable-opengl -thread -no-g++-exceptions -disable-xml -disable-sql -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -qt-libpng -qt-libjpeg -qt-libmng -qt-imgfmt-jpeg -qt-imgfmt-mng -qt-imgfmt-png
</code>

<h4>COIN = http://www.sim.no</h4>
You need the main COIN library ('Coin-2') and SoQt. For the volume rendering plugin, find the SIMVoleon download too. In rare cases you also want simage. Our configuration:
<code>
./configure --disable-debug --disable-symbols --enable-shared --disable-static --enable-vrml97 --enable-threadsafe --enable-rtti --disable-warnings --disable-dependency-tracking --enable-html CFLAGS="-O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64" CPPFLAGS="-O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64" LDFLAGS="-s -O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -lstdc++"
</code>
</p>
Once this is done, you have to make sure:
<ul>
<li>your shared libs are used, not the distribution's. Replace libqt-mt.so.3, libCoin.so.xx, libSoQt.so.xx etc. in $WORK/bin/$HDIR/so.
<li>the header files can be found by Pmake. Look in $WORK/Pmake/make.od.Dirs. You can either edit this file, or create an 'APPMANROOT' directory with links to your COIN and Qt installations - then set APPMANROOT_OVERRULE to that directory.
</ul>
Now, you can make all directories. This can be a lot of work going in and out of all source directories, so you may want a Makefile in your $WORK. You may even want to use our root make file, e.g. by linking our 'RootMakefile', as in
<code>cd $WORK; ln -s Pmake/RootMakefile ./Makefile</code>
Similarly, in the plugins directory use Makefile.od . But in this case you'd probably rather want to include that file in your own Makefile, see comments in Makefile.od for details.
<p>


<br>
<img src="../hr.png" border=0>

<p>
<center>
  <a href="index.html">Index</a>
| <a href="overview.html">Overview</a>
| <a href="plugins.html">Plugins</a>
| <a href="pmake.html">Pmake</a>
| <a href="http://www.opendtect.org">opendtect.org</a>
</center>
</p>

</body>
</html>
