<html>
<!--
  - CopyRight:  (C) dGB Earth Sciences
  - Author:     A.H. Lammertink / A.H. Bril
  - Date:       Nov 2003
  - Contents:   Windows specific stuff for programmers
  - RCS:        $Id: windows.html,v 1.1 2003-11-28 15:04:29 bert Exp $
 -->

<body background="../backg.png"><title>Windows development [OpendTect Programmer's manual V1.0]</title>
<center>
<h1>OpendTect development on MS Windows</h1>
  <a href=#external>External installations</a>
| <a href=#setup>Setup</a>
| <a href=#buildod>Building OpendTect</a>
</center>
<br>
<img src="../hr.png" border=0>

<a name=external><h2>External installations</h2></a>

<a name=mingw><h3>MinGW</h3></a>

<p>First, download MinGW from <a href="http://mingw.org/download.shtml">http://mingw.org/download.shtml</a>.
The easiest way to install is to download the MinGW auto-extracting executable, MinGW-&lt;version&gt;.exe. This file is approximately 14 MB. After download, just run the installer.
Optionally, you can install gdb 6.0, which can be downloaded at: <a href="http://gd.tuwien.ac.at/gnu/mingw/?fisel=gG">http://gd.tuwien.ac.at/gnu/mingw/?fisel=gG</a></p>
<p>It is recommended to install mingw at its default location: c:\MinGW</p>
<h3>Cygwin</h3>
<p>Since MinGW only provides a compiler and we also need tools like a Unix-shell, sed, awk, etc., we use Cygwin as our shell/work environment.</p>
<p>Download the Cygwin installer from <a href="http://cygwin.com">http://cygwin.com</a> and run it.
At a certain point, you can select where to install cygwin. It is recommended to use the default : C:\cygwin</p>
<p>After a few questions, you can select packages to install. Choose at least the following packages:</p>
<ul>
<li>make (development)</li>
<li>tcsh (shells)</li>
<li>perl (interpreters)</li>
<li>gawk (interpreters)</li>
</ul>
<p>Also recommended:</p>
<ul>
<li>cvs (development)</li>
<li>zip (archive)</li>
<li>unzip (archive)</li>
<li>bizon (dev) (*)</li>
<li>flex (dev) (*)</li>
<li>doxygen (dev)</li>
<li>vim (editors)</li>
<li>openssh (net)</li>
</ul>
<p>(*) Bison and Flex are required to build OpendTect itself.</p>


<a name=setup><h2>Setting up the environment</h2></a>
<p><a href="pmake.html">Pmake</a> is used to build both the system and to build plugins.
It requires a few environment variables to be setup and it expects a certain directory structure in your work directory.</p>
<h3>Setup work dir</h3>
<p>Before you can build anything, you have to setup the work directory in such a way that Pmake can use it. The easiest way to do this is from within OpendTect, menu 'Utilities-Create Development Environment'.</p>
<p>It is strongly recommended to make sure that there are no spaces in the path to your work directory.</p>
<h3>Setup environment variables</h3>
<p>Once you have successfully created ODWork directory, you have to setup a few environment variables: HDIR, WORK, MINGWHOME and GNUMAKE.</p>
<p>HDIR defines the platform you're working on. On windows, this should be set to win.</p>
<p>MINGWHOME defines the location of the MinGW compiler.</p>
<p>GNUMAKE gives the name of gnu make, usually just make or gmake. If you don't set GNUMAKE, Pmake expects gnu make to be named gmake and expects it in your search path.</p>
<p>WORK defines where your work directory is. Pmake expects a certain directory structure there, so it is best to use the script below to set it up and copy the relevant parts from your program installation into your work directory.</p>
<p>IMPORTANT: WORK <b>has</b> to be a full path, starting with /cygdrive. Otherwise, it won't work.</p>
<p>Beside setting up these environment variables, you should source either the PMinit.csh or the PMinit.sh script present in the $WORK/Pmake/base directory.</p>
<p>In case you are working with bash, you could add something like the following to your .bashrc which is located in what cygwin sees as your home directory, which should be at /home/&lt;login name&gt;:</p>
<pre>
export WORK="/cygdrive/c/home/Administrator/work"
export MINGWHOME=/cygdrive/c/MinGW

export HDIR=win
export GNUMAKE=make

source "$WORK/Pmake/base/PMinit.sh"</pre>
<p>Fortunately, if you have followed our instructions well, you can set the entire environment with a single setup script that is generated in the new ODWork directory. The coice is betwee 'init.bash' or 'init.csh', depending on the shell you want to work in.</p>
<p>You may have to edit the location of your MinGW compiler; the init scripts assume it is at /cygdrive/c/MinGW.</p>
<h4>Setting up OpendTect paths</h4>
<p>As an extra, one can add the OpendTect win executable paths to your search path from your .bashrc, so you can directly start dtect from your bash shell (using start_dtect.csh). This is already done in the generated init scripts.
As you can see the location of the OpendTect base directory is stored in the windows registry and can be read from a bash script (i.e. your .bashrc). Using this location, we can setup the right search path.</p>
<h4>Checking the MinGW installation</h4>
<p>It is important that MinGW is in your search path (and that it comes before the cygwin binary path $cygwin/bin if you have installed the cygwin gcc compiler&amp;friends). You can either set the path under cygwin in your .bashrc (bash) or your .login (csh) or use "My Computer - properties - advanced - Environment Variables" to edit the Path environment variable from Windows.</p>
<p>To see if your path is correctly set, you can retrieve the version of the C compiler and see if the result contains the word mingw:</p>
<pre>
~$gcc --version
gcc.exe (GCC) 3.2 (mingw special 20020817-1)
Copyright (C) 2002 Free Software Foundation, Inc.
This is free software; see the source for copying conditions. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</pre>
<p>In constrast, if you have done something wrong, you would see something like:</p>
<pre>
~$/c/programs/cygwin/bin/gcc --version
gcc (GCC) 3.2 20020927 (prerelease)
Copyright (C) 2002 Free Software Foundation, Inc.
This is free software; see the source for copying conditions. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</pre>
<h3>Building your own plugins</h3>
<h4>Testing the installation</h4>
<p>After you setup your environment, open a new cygwin bash shell and go to your work directory. If all is well, the alias 'cwd' should bring you directly to your work directory. Then go to the plugins directory and type 'make'. You should see something like this:</p>
<pre>
$ cd plugins/

Administrator@tazzie-win2k /cygdrive/c/cygwin/home/Administrator/work/plugins
$ make
make[1]: Entering directory `/cygdrive/c/cygwin/home/Administrator/work/plugins/Hello'
  Making Hello / Microsoft Windows (Nov 27 13:18:33) DEBUG=no.
Compiling hellopi.cc ...
Ranlib on Hello.lib ...
Creating /cygdrive/c/cygwin/home/Administrator/work/lib/win/O/Hello.dll ...
  Done !
make[1]: Leaving directory `/cygdrive/c/cygwin/home/Administrator/work/plugins/Hello'

&lt;snip&gt;

make[1]: Entering directory `/cygdrive/c/cygwin/home/Administrator/work/plugins/uiSeisIOSimple'
  Making uiSeisIOSimple / Microsoft Windows (Nov 27 13:19:14) DEBUG=no.
Compiling seisiosimple.cc ...
Compiling uiseisiosimple.cc ...
Compiling uiseisiosimplepi.cc ...
Ranlib on uiSeisIOSimple.lib ...
Creating /cygdrive/c/cygwin/home/Administrator/work/lib/win/O/uiSeisIOSimple.dll
 ...
  Done !
make[1]: Leaving directory `/cygdrive/c/cygwin/home/Administrator/work/plugins/uiSeisIOSimple'

Administrator@tazzie-win2k /cygdrive/c/cygwin/home/Administrator/work/plugins
$</pre>
<p>The libraries should now be made in $WORK/lib/win. We can check that, like this:</p>
<pre>
Administrator@tazzie-win2k /cygdrive/c/cygwin/home/Administrator/work/plugins
$ cdw

Administrator@tazzie-win2k /cygdrive/c/cygwin/home/Administrator/work
$ cd lib/win/

Administrator@tazzie-win2k /cygdrive/c/cygwin/home/Administrator/work/lib/win
$ ls
Coh.dll*    O@                 libuiSeisIOSimple.dll.a*  uiSeisIOSimple.dll*
Coh.lib*    libCoh.dll.a*      uiCoh.dll*                uiSeisIOSimple.lib*
G@          libHello.dll.a*    uiCoh.lib*
Hello.dll*  libuiCoh.dll.a*    uiHello.dll*
Hello.lib*  libuiHello.dll.a*  uiHello.lib*

Administrator@tazzie-win2k /cygdrive/c/cygwin/home/Administrator/work/lib/win $
</pre>


<a name=buildod><h2>Building OpendTect</h2>
<p>OpendTect relies on a number of external libraries to function. All these external libraries have been properly insulated, so there should be no need to recompile these if you want to build Open d-Tect yourself.</p>
<p>However, should you really want to, here are some guidelines. Beware that especially compiling Coin's <u>SoQt</u> is quite tricky and can take a considerable amount of time and tweaking to get it right.</p>
<h3>Qt</h3>
<p>Qt does not officialy support <u>MinGw</u><a href="MinGw?action=edit"></a>, but as of version 3.2.1 it should build out of the box.</p>
<h3>Pthreads</h3>
<p>The pthreads-win32 library can be downloaded from <a href="http://sources.redhat.com/pthreads-win32/">http://sources.redhat.com/pthreads-win32/</a>.
<p>You also might want to check out the faq: <a href="http://sources.redhat.com/pthreads-win32/faq.html">http://sources.redhat.com/pthreads-win32/faq.html</a></p>
<p>You need to copy the include files into the MinGW include directory (default c:\MinGW\include) and the proper dll with accompaning import library (pthreadGC.dll and libpthreadGC.a) into  the MinGW lib directory (default c:\MinGW\lib)</p>
<h3>Coin</h3>
<p>Coin does not officially support anything other then VC++.</p>
<p>However, older versions of Coin required cygwin as a build environment. This was necessary in order to make use of the command-line MSVC compiler, cl.exe, which was called using a wrapper program (wrapmsvc).</p>
<p>Fortunately, the Coin config scripts can handle MinGW quite well. Only in the case of <u>SoQt</u> we have to revert to using a wrapper script that converts cygwin's paths into Windows paths before calling the mingw compiler.</p>
<p>You can find the wrapper script in the Pmake/base/bin/win directory, either in your work directory or in the installation directory (c:\Program files\OpendTect\bin\win by default).</p>
<p>Coin itself and simage both compile pretty straightforward without the wrapper scripts, just configure &amp; make from a cygwin shell (make sure the MinGW compiler is in your path..).</p>
<p>It might be that the libtool complains about not being able to find certain dlls. This cost me a lot of time, until I found out that the required dlls have to be in the search path ($PATH). Passing a -L&lt;path to dll&gt; did not work.</p>
<p>Compiling <u>SoQt</u> is a little trickier. This really needs the wrapper script to convert cygwin paths to win32 ones. When running configure from a c-shell, you need something like:</p>
<pre>
setenv CC "$PMAKE/bin/win/wrapit gcc"
setenv CXX "$PMAKE/bin/win/wrapit g++"
setenv AR "/usr/bin/ar"

set cflags="$cflags -DCOIN_DLL"
set ldflags="$ldflags -DCOIN_DLL"</pre>
<p>Note that in this case, we use Cygwin's ar, which means you'd have to install the binutils package under cygwin.</p>

<br>
<img src="../hr.png" border=0>

<p>
<center>
  <a href="index.html">Index</a>
| <a href="overview.html">Overview</a>
| <a href="plugins.html">Plugins</a>
| <a href="pmake.html">Pmake</a>
| <a href="http://www.opendtect.org">opendtect.org</a>
</center>
</p>

</body>
</html>
