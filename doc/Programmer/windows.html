<html>
<!--
  - CopyRight:  (C) dGB Earth Sciences
  - Author:     A.H. Lammertink / A.H. Bril
  - Date:       Nov 2003
  - Contents:   Windows specific stuff for programmers
  - RCS:        $Id: windows.html,v 1.32 2012-01-17 10:08:50 cvsranojay Exp $ 
  -->

<body background="backg.png"><title>Windows development [OpendTect
Programmer's manual V4.2]</title>

<center>
<h1>OpendTect development on MS Windows</h1>
  <a href=#external>External installations</a>
| <a href=#setup>Setup</a>
| <a href=#buildod>Building OpendTect</a>
</center>

<br>
<img src="hr.png" border=0>

<a name=external><h2>External installations</h2></a>

<p> The external installations can, in principle, be installed wherever
you like. </p>


<h3>Visual Studio 10</h3>

<p>OpendTect 4.3 is built with Visual Studio 2010 (version 10), and it also supports Visual Studio 2010 express edition. The express edition can be downloaded from Microsoft's official web site <a href="http://www.microsoft.com/visualstudio/en-us/products/2010-editions/visual-cpp-express"> here </a> </p>

<h3>Vim editor</h3>
<p>Visual Studio comes with it's own editor. For real coding, vim is still superiour and is our preferred editor. The Windows version can be downloaded from:
http://www.vim.org/ </p>


<h3>Qt</h3>
A Qt installation is only necessary when you want to build a plugin which is directly dependend on Qt. Download Windows Qt package from the <a href="http://qt.nokia.com/"> Qt website </a>. 


<h3>Coin and friends</h3>
<p>A full Coin installation is only necessary when you want to build a plugin which is directly dependend on Coin. Download Windows Coin, SoQt and SIMVoleon packages from <a href="http://coin3d.org/">Coin website </a>. Or get the source code from <a href="http://tortoisehg.bitbucket.org/">Mercurial</a> repositories and build yourself using Visual Studio. Check this <a href="http://www.coin3d.org/doc/mercurial_access/">link</a> for more details</p>
<br>

<a name=setup><h3>Setup ODWork dir</h3>

<p> Before you can build anything, you have to setup a work directory
(usually called 'ODWork'). The easiest way to do this is from within
OpendTect, menu 'Utilities-Tools-Create
Devel Env', but make sure you have downloaded and installed the developer package in the same location where OpendTect is already installed. Note that the OpendTect application window will freeze while the development environment is created. The developer package could also be installed right in to the ODWork folder, in that case the ODWork immediatly becomes the "WORK" directory and you won't have to use OpendTect ->menu -> 'Utilities-Tools-Create
Devel Env'  </p>


<h3>Setup environment variables</h3>

<p> Now you will have to setup at least one environment variable, i.e. WORK, and also OD_COINDIR for Coin and OD_QTDIR for Qt if needed. An easy method has been devised to setup all the environment variables through batch file instead of going through the 'My Computer' which is a bit cumbersome. Inside the msvc10 folder there is a batch file named odvars_example.bat, this file is just an example of adding environment variables with batch file. All you have to do is create another batch file at the same location and rename it to "odvars.bat" and copy the contents of the odvars_example.bat file in to it and edit the paths according to your local settings, now double-click on start_msvc_od.bat file, which is already there, this will load the OpendTect solution in Visual Studio IDE using the variables from the odvars.bar file. So now you are ready to work. This is only one time work and no need to do it every time you use start_msvc_od.bat to start OpendTect solution. The other method is Right-click on 'My Computer', select Properties, Advanced tab and click on the button 'Environment variables'. Add a new variable WORK and set its value to the directory created by the 'Create Devel Env' i.e. the fullpath of the "ODWork .
If you're using Qt and/or Coin, you'll have to set OD_QTDIR and OD_COINDIR likewise.  
</p>
<br>

<h3>Building your own plugins</h3>

<h4>Testing the installation</h4>

<p> After you setup your environment, goto the plugins\msvc10 folder and open the Tutorial solution. When openened, build the solution from the Build menu, the toolbar, or the Solution right-click menu.</p>

<p> The libraries should now be ready in $WORK\plugins\msvc10\Win32|x64\debug|release.
</p>


<h4>Testing the newly compiled plugins</h4>

<p>
You can test your newly compiled plugins by loading them using the
Utilities-plugins menu in OpendTect. For example, if you load the "Hello.dll"
plugin, you should see "Hello World" on the OpendTect console window. Notes:
<ul>

<li>For some reason the manual loading of plugins can fail on the very
first attempt with an error message from windows that it is not able
to find the plugin. Maybe someone with knowledge about the dark
corners of Windows can explain us why. In any case, if you try again
it works. </li>

<li>If you want to load one of the 'ui' plugins, you have to load the
corresponding non-ui one first. </li>

<li>You cannot re-load a plugin. Even more so: once loaded, the DLL
remains locked by windows until you exit OpendTect. Thus, if you
change any code you'd better exit OpendTect before trying to re-build
the plugin. If you don't exit OpendTect you'll get an error message
like: 'cannot overwrite .... Permission denied'. </li>

<li>By default Visual Studio creates the "Debug" versions of the Dlls which cannot be directly loaded in to OpendTect. If you want to load your plugin in OpendTect, change the project configuration to release and build your code in release mode, now it will be possible to load the plugin. </li>


</ul>
</p>
<br>

<a name=installplugins><h4>Installing your plugins</h4>

<p> 'Installing' a plugin would be making the plugin auto-load at
OpendTect startup. Basically, this is done by copying the plugin to
the correct plugin subdirectory in either your personal '.od' settings
directory or in the program installation directory. After that, you
need to create a new ".alo" file, or add the plugin to an existing
".alo" file.  The procedure is the same on Unix and Windows, so please
consult the plugins <a href="plugins.html#autoload">auto-load and
installation</a> documentation for more details. </p>

<p> There are a few remarks about the location of your personal
directory on windows though. Your 'Personal directory' is located at
$HOME if this is defined, which is normally taken care of by the
cygwin tcsh shell. Otherwise, the location of $USERPROFILE or
eventually $APPDATA is used. This takes place in the
"bin/init_dtect_user" script, which sets the environment variable
"DTECT_SETTINGS" which on its turn is used internally in OpendTect,
unless overridden by "DTECT_WINSETTINGS"</p>

<p> If you want your personal '.od' settings directory to be somewhere
else, you can set the "DTECT_WINHOME" and or the "DTECT_WINSETTINGS"
environment variable. The first overrides $HOME and thus also 
specifies a new location for the '.od' settings directory; the latter
specifies the '.od' directory itself -- you should even be able to
give it another name, although this is not recommended.</p>

<p> You can set environment variables using  "My Computer - properties
- advanced - Environment Variables", but you can also edit the
start_dtect.bat file or a copy of it.</p>

<br>

<a name=dist><h2>Distributing your plugins:</h2>

<p> The distribution of plugins is basically the same for Unix and
windows.  Just copy the .alo files into the plugins/platform directory    
(<code>$DTECT_APPL/plugins/$HDIR</code>, default <code>C:\Program
Files\OpendTect\plugins\win</code> on windows) and copy the actual
plugins into the libs subdirectory. </p>


<p> In order to do this, we use .tar.gz files on Unix and inno-setup on
windows, which can be obtained for free at:  <a
href="http://www.jrsoftware.org/isinfo.php">jrsoftware.org</a>. </p>

<p> Because we internally treat Windows as much like Unix as we can, we
actually make a .tar.gz file for our windows plugins too, which is
extracted to "d:\users\admin\rel\plugins\opendtect-4.x.y\", which forms
the "Source" for Inno-Setup. </p>

<p> As an example, here is the Inno-setup file "dgbsetup.iss" that we
use for our own dgb plugins. Note that the OpendTect installation
directory is stored in the registry and used as 'DefaultDirName':</p>

<pre>
[Setup]
AppName=OpendTect
AppVerName=OpendTect 4.x.y
AppPublisher=De Groot-Bril Earth Sciences
AppPublisherURL=http://www.opendtect.org
AppSupportURL=http://www.opendtect.org
AppUpdatesURL=http://www.opendtect.org
DefaultDirName={reg:HKLM\OpendTect\Base\Settings,Path|{pf}\OpendTect}
DisableDirPage=yes
DefaultGroupName=OpendTect
AllowNoIcons=yes
OutputBaseFilename=myplugin-opendtect-4.x.y
LicenseFile=d:\users\admin\rel\opendtect-4.x.y\LICENSE.txt


[Files]
Source: d:\users\admin\rel\plugins\opendtect-4.x.y\*; DestDir: {app}; Flags: recursesubdirs
</pre>
<br>

<a name=buildod><h2>Building OpendTect</h2></a>
<p>
OpendTect solution and OpendTect plugins solution can be found in $WORK\msvc10. From these solutions it should be quite easy to build OpendTect from scratch. Note that it requires an installation of Qt and Coin. The currently used versions can be found in: $DTECT_APPL\doc\ReleaseInfo\RELEASEINFO.txt
</p>


<br>
<img src="hr.png" border=0>

<p>
<center>
  <a href="index.html">Index</a1
| <a href="overview.html">Overview</a>
| <a href="plugins.html">Plugins</a>
| <a href="pmake.html">Pmake</a>
| <a href="http://www.opendtect.org">opendtect.org</a>
</center>
</p>

</body>
</html>
