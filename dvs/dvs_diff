#!/bin/csh -f
# SVN: $Id$

if ( $#argv < 1 ) then
    echo "Usage: $0 [-r <revision>] <file> "
    exit 1
endif

if ( "$1" == "-r" ) then
    shift
    set rev="-r $1"
    shift
else
    set rev=""
endif

set diffinp=$1

if ( ! -d CVS ) then
    if ( "$rev" == "" ) then
	set dir=$diffinp:h
	set file=$diffinp:t
	if ( $dir == $diffinp ) set dir=.
	echo "tkdiff $dir/.svn/text-base/${file}.svn-base ${diffinp}"
	tkdiff $dir/.svn/text-base/${file}.svn-base ${diffinp}
	exit 0
    endif

    echo "No support for diff with previous revision yet"
    echo "Please use 'dvs diff' for time being"
    exit 1
else
    set reposfile=./CVS/Repository
    if ( ! -e $reposfile ) then
	set filedir=`echo $1 | sed 's/\/.*$//'`
	cd $filedir
	set diffinp=`echo $diffinp|sed "s/$filedir\///"`
    endif

    set repos=`cat $reposfile`
    dvs co -p ${rev} $repos/$diffinp > /tmp/mdiff.$$
endif

tkdiff /tmp/mdiff.$$ $diffinp
\rm /tmp/mdiff.$$
