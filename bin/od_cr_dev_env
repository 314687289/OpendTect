#!/bin/sh
#_______________________________________________________________________________
#
# (C) dGB Beheer B.V.
# $Id: od_cr_dev_env,v 1.13 2004-01-07 14:51:47 arend Exp $
#
# Script copies sources and libs into a development directory
#
#_______________________________________________________________________________


if [ "$#" -lt 2 ]; then
	echo "Usage : $0 OpendtTect_directory existing_target_directory"
	exit 1
fi

if [ "$HDIR" = "win" ]; then
    inpdir=`cygpath -u "$1"` 
    outdir=`cygpath -u "$2"`
    soext=dll
else
    inpdir=$1
    outdir=$2
    soext=so
fi

if [ ! -d "$inpdir" ] || [ ! -e "$inpdir/.rel.od.doc" ]; then
	echo "$0 : $inpdir does not have the doc package installed"
	exit 1
fi

if [ ! -w "$outdir"  ]; then
	echo "$0 : target directory $outdir not writable"
	exit 1
fi


# ----------------------------------------------------------------------------
# Setup work directory
# ----------------------------------------------------------------------------

cd "$outdir"

for item in plugins src include Pmake
do 
    cp -a "$inpdir/$item" .

done 

if [ -d plugins ]; then
    cd plugins
    if [ -e Makefile.lnk ]; then
	\rm Makefile.lnk
    fi
    if [ ! -e Makefile ]; then
        ln -s Makefile.od Makefile
    fi
fi

cd "$outdir"

mkdir lib
cd lib
mkdir $HDIR
cd $HDIR
ln -s . G
ln -s . O

cd "$outdir"
mkdir bin
cd bin
mkdir $HDIR
cd $HDIR
ln -s . G
ln -s . O
mkdir so
cd so


cp -a "$inpdir/bin/$HDIR/so"/*.$soext .
if [ "$HDIR" = "win" ]; then
    cp -a "$inpdir/bin/$HDIR/so"/*.a .
fi


cd "$outdir"

for fil in init.bash init.csh 
do
    sed -e "s%__WORK__%$outdir%" \
        -e "s%__hdir__%$HDIR%" \
        "$inpdir/.$fil" > $fil
done

cp "$inpdir/.rel.od.doc" .
